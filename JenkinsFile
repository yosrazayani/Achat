pipeline {
    agent any
    stages {
        stage("GIT") {
            steps {
                echo "Getting Project from Git"
                git branch: "main",
                    url: "https://github.com/yosrazayani/Achat.git"
            }
        }
    stage('MVN BUILD') {
            steps {
                 sh 'mvn clean'
                    sh 'mvn compile'
                    sh 'mvn install'

        }
        }




        stage("SONARQUBE") {
                    steps {
                  //  dir('Achat') {
        // sh "mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=P@ssw0rd"
        sh 'mvn clean package sonar:sonar'
}
                   // }
                }

       stage("MOCKITO") {
         steps {

                    sh 'mvn test'

            }
        }



        stage("NEXUS") {
            steps {

                    sh 'mvn deploy'
                }
        }



        stage('docker compose') {
            steps {

                    sh 'docker compose down --rmi all'
                    sh 'docker compose up -d'

            }
        }

        // stage('MAIL BUILD') {
        //     steps {
        //         script {
        //             currentBuildResult = currentBuild.result
        //             emailext subject: "${currentBuildResult == 'SUCCESS' ? 'Build Successful' : 'Build Failed'}",
        //                     body: "Le build a abouti avec le statut : ${currentBuildResult}",
        //                     recipientProviders: [[$class: 'DevelopersRecipientProvider']],
        //                     to: 'oumaymalyna.khaznaji@esprit.tn',
        //                     from: 'oumaymalyna.khaznaji@esprit.tn',
        //                     replyTo: 'oumaymalyna.khaznaji@esprit.tn'
        //         }
        //     }
        // }
    }
}
