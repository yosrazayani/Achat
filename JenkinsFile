pipeline {
    agent any
    environment {
            // Define any environment variables needed for the build or deployment
            NEXUS_URL = 'http://172.17.0.1:8081' // Replace with your Nexus server URL
            NEXUS_USERNAME = 'admin'
            NEXUS_PASSWORD = 'P@ssw0r2' // Consider using credentials plugin for secrets
        }
    stages {
        stage("GIT") {
            steps {
                echo "Getting Project from Git"
                git branch: "main",
                    url: "https://github.com/yosrazayani/Achat.git"
            }
        }
    stage('MVN BUILD') {
            steps {
                 sh 'mvn clean'
                    sh 'mvn compile'
                    sh 'mvn install'

        }
        }




        stage("SONARQUBE") {
                    steps {
                  //  dir('Achat') {
        // sh "mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=P@ssw0rd"
        sh 'mvn clean package sonar:sonar'
}
                   // }
                }

       stage("MOCKITO") {
         steps {

                    sh 'mvn test'

            }
        }



        stage("NEXUS") {
            steps {

                    sh "mvn deploy -Dnexus.url=${env.NEXUS_URL} -Dnexus.username=${env.NEXUS_USERNAME} -Dnexus.password=${env.NEXUS_PASSWORD}"
                }
        }



        stage('docker compose') {
            steps {

                    sh 'docker compose down --rmi all'
                    sh 'docker compose up -d'

            }
        }

        // stage('MAIL BUILD') {
        //     steps {
        //         script {
        //             currentBuildResult = currentBuild.result
        //             emailext subject: "${currentBuildResult == 'SUCCESS' ? 'Build Successful' : 'Build Failed'}",
        //                     body: "Le build a abouti avec le statut : ${currentBuildResult}",
        //                     recipientProviders: [[$class: 'DevelopersRecipientProvider']],
        //                     to: 'oumaymalyna.khaznaji@esprit.tn',
        //                     from: 'oumaymalyna.khaznaji@esprit.tn',
        //                     replyTo: 'oumaymalyna.khaznaji@esprit.tn'
        //         }
        //     }
        // }
    }
}
